<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>DreamWeaver AI</title>
  <link rel="manifest" href="./manifest.json" />
  <meta name="theme-color" content="#16213e" />
  <link rel="icon" href="./icon-192x192.png" />
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">

  <style>
    body{margin:0;font-family:Roboto;background:linear-gradient(135deg,#1a1a2e,#16213e);color:#fff;display:flex;flex-direction:column;min-height:100vh}
    header{padding:16px;text-align:center;background:#0f3460;font-size:20px;font-weight:700;letter-spacing:1px}
    main{flex:1;padding:16px}
    section{display:none;animation:fadeIn .3s}
    section.active{display:block}
    @keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
    h1,h2,h3{margin-top:0}
    textarea,select,input[type=file]{width:100%;padding:10px;border-radius:8px;border:0;background:rgba(255,255,255,0.08);color:#fff;margin:8px 0}
    button{background:#e94560;border:0;padding:10px 14px;border-radius:8px;color:#fff;font-weight:700;cursor:pointer;margin:4px 0}
    button.secondary{background:#444}
    .card{background:rgba(255,255,255,0.06);padding:16px;border-radius:12px;margin-bottom:16px;box-shadow:0 4px 12px rgba(0,0,0,0.3)}
    .result img{max-width:100%;border-radius:8px;margin-top:8px}
    nav{position:fixed;bottom:0;left:0;right:0;background:#0f3460;display:flex;justify-content:space-around;padding:8px 0}
    nav button{flex:1;background:none;border:none;color:#e94560;font-weight:700;font-size:14px}
    nav button.active{color:#fff;border-top:2px solid #e94560}
  </style>
</head>
<body>
  <header>üåô DreamWeaver AI</header>
  <main>
    <!-- Ana sayfa -->
    <section id="home" class="active card">
      <h2>Ho≈ü geldin ‚ú®</h2>
      <p>R√ºya tabiri, kahve & el falƒ±, tarot ve g√ºnl√ºk ilham i√ßin hepsi bir arada.</p>
      <button onclick="show('dream')">R√ºya Tabiri</button>
      <button onclick="show('fortune')" class="secondary">Fal & Tarot</button>
    </section>

    <!-- R√ºya tabiri -->
    <section id="dream" class="card">
      <h2>R√ºya Tabiri</h2>
      <label for="zodiac">Burcun:</label>
      <select id="zodiac">
        <option>ko√ß</option><option>boƒüa</option><option>ikizler</option><option>yenge√ß</option>
        <option>aslan</option><option>ba≈üak</option><option>terazi</option><option>akrep</option>
        <option>yay</option><option>oƒülak</option><option>kova</option><option>balƒ±k</option>
      </select>
      <textarea id="dreamText" rows="5" placeholder="R√ºyanƒ± yaz..."></textarea>
      <button onclick="analyzeDream()">AI ile Tabir Et</button>
      <button onclick="visualizeDream()" class="secondary">G√∂rselle≈ütir</button>
      <div id="dreamResult" class="result"></div>
    </section>

    <!-- Fal -->
    <section id="fortune" class="card">
      <h2>Fal & Tarot</h2>
      <select id="fortuneType">
        <option value="kahve">Kahve Falƒ±</option>
        <option value="el">El Falƒ±</option>
        <option value="tarot">Tarot</option>
      </select>
      <input type="file" id="fortuneImage" accept="image/*">
      <button onclick="analyzeFortune()">Fal Bak</button>
      <div id="fortuneResult" class="result"></div>
    </section>

    <!-- Premium -->
    <section id="premium" class="card">
      <h2>Premium</h2>
      <p>üìå Daha detaylƒ± tabirler, y√ºksek √ß√∂z√ºn√ºrl√ºkl√º g√∂rseller, tarot rehberi ve reklamsƒ±z deneyim.</p>
      <button onclick="subscribe()">Premium Ol ($4.99/ay)</button>
    </section>
  </main>

  <nav>
    <button onclick="show('home')" class="active">Ana</button>
    <button onclick="show('dream')">R√ºya</button>
    <button onclick="show('fortune')">Fal</button>
    <button onclick="show('premium')">Premium</button>
  </nav>

  <script>
    let isPremium = localStorage.getItem("isPremium")==="true";

    function show(id){
      document.querySelectorAll("main section").forEach(s=>s.classList.remove("active"));
      document.getElementById(id).classList.add("active");
      document.querySelectorAll("nav button").forEach(b=>b.classList.remove("active"));
      document.querySelector(`nav button[onclick="show('${id}')"]`).classList.add("active");
    }

    async function analyzeDream(){
      const text=document.getElementById("dreamText").value;
      const zodiac=document.getElementById("zodiac").value;
      if(!text) return alert("R√ºyanƒ± yaz!");
      document.getElementById("dreamResult").innerHTML="‚è≥ Tabir hazƒ±rlanƒ±yor...";
      const r=await fetch("/api/analyzeDream",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text,zodiac,isPremium})});
      const j=await r.json();
      document.getElementById("dreamResult").innerHTML="<p>"+j.analysis+"</p>";
    }

    async function visualizeDream(){
      const text=document.getElementById("dreamText").value;
      if(!text) return alert("R√ºyanƒ± yaz!");
      document.getElementById("dreamResult").innerHTML="‚è≥ G√∂rsel hazƒ±rlanƒ±yor...";
      const r=await fetch("/api/visualize",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({text,isPremium})});
      const j=await r.json();
      document.getElementById("dreamResult").innerHTML='<img src="'+j.imageUrl+'" alt="R√ºya g√∂rseli">';
    }

    async function analyzeFortune(){
      const type=document.getElementById("fortuneType").value;
      const file=document.getElementById("fortuneImage").files[0];
      let img=null;
      if(file){const r=new FileReader();r.onload=e=>img=e.target.result;r.readAsDataURL(file);}
      document.getElementById("fortuneResult").innerHTML="‚è≥ Fal bakƒ±lƒ±yor...";
      const r=await fetch("/api/analyzeFortune",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({type,isPremium,img})});
      const j=await r.json();
      document.getElementById("fortuneResult").innerHTML="<p>"+j.comment+"</p>";
    }

    function subscribe(){
      isPremium=true;localStorage.setItem("isPremium","true");
      alert("Premium aktif!");
    }

    if("serviceWorker" in navigator){
      navigator.serviceWorker.register("./sw.js");
    }
  </script>
</body>
</html>
